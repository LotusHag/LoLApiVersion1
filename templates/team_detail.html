i<!-- templates/team_detail.html -->

{% extends 'base.html' %}

{% block content %}
<div class="team-detail-container">
    <!-- Header Section -->
    <div class="header-section">
        <h2>{{ team_detail['team_name'] }}</h2>
        <p><strong>Split:</strong> {{ team_detail['split'] }} | <strong>Division:</strong> {{ team_detail['division'] }}</p>
    </div>

    <!-- Main Layout Grid -->
    <div class="main-layout">
        <!-- Stats Section -->
        <div class="stats-section">
            <h3>Team Stats</h3>
            <p><strong>Win Rate:</strong> {{ (team_detail['wins'] / (team_detail['wins'] + team_detail['losses'])) * 100 | round(1) }}% | <strong>Wins:</strong> {{ team_detail['wins'] }} | <strong>Losses:</strong> {{ team_detail['losses'] }}</p>
            <p><strong>Average Kills:</strong> {{ (team_detail['stats_totals'].get('kills', 0) / (team_detail['stats_totals'].get('matches', 1))) | round(1) }}</p>
            <p><strong>Average Deaths:</strong> {{ (team_detail['stats_totals'].get('deaths', 0) / (team_detail['stats_totals'].get('matches', 1))) | round(1) }}</p>
            <p><strong>Average Assists:</strong> {{ (team_detail['stats_totals'].get('assists', 0) / (team_detail['stats_totals'].get('matches', 1))) | round(1) }}</p>
        </div>

        <!-- Champion Statistics Section -->
        <div class="champion-stats-section">
            <div class="champion-table">
                <div class="champ-column">
                    <div class="header-container">
                        <div class="header-box">
                            <h4>Played</h4>
                        </div>
                        <div class="total-box">
                            <p>Total: {{ team_detail['champions_played'] | length }}</p>
                        </div>
                    </div>
                    <ul class="scrollable-list">
                        {% for champ_name, count in team_detail['champions_played'] | dictsort(reverse=true, by='value') %}
                        <li>
                            <div class="champion-item">
                                <img src="https://ddragon.leagueoflegends.com/cdn/{{ latestVersion }}/img/champion/{{ champ_name }}.png" alt="{{ champ_name }}" class="champ-icon">
                                <span class="champ-count">{{ count }}</span>
                            </div>
                        </li>
                        {% endfor %}
                    </ul>
                </div>

                <div class="champ-column">
                    <div class="header-container">
                        <div class="header-box">
                            <h4>Banned Against</h4>
                        </div>
                        <div class="total-box">
                            <p>Total: {{ team_detail['bans_against'] | length }}</p>
                        </div>
                    </div>
                    <ul class="scrollable-list">
                        {% for champ_id, count in team_detail['bans_against'] | dictsort(reverse=true, by='value') %}
                        <li>
                            {% set champ_name = championMap[champ_id|int] if champ_id|int in championMap else 'Unknown' %}
                            <div class="champion-item">
                                <img class="champ-icon" src="https://ddragon.leagueoflegends.com/cdn/{{ latestVersion }}/img/champion/{{ champ_name }}.png" alt="{{ champ_name }}">
                                <span class="champ-count">{{ count }}</span>
                            </div>
                        </li>
                        {% endfor %}
                    </ul>
                </div>

                <div class="champ-column">
                    <div class="header-container">
                        <div class="header-box">
                            <h4>Banned</h4>
                        </div>
                        <div class="total-box">
                            <p>Total: {{ team_detail['bans_made'] | length }}</p>
                        </div>
                    </div>
                    <ul class="scrollable-list">
                        {% for champ_id, count in team_detail['bans_made'] | dictsort(reverse=true, by='value') %}
                        <li>
                            {% set champ_name = championMap[champ_id|int] if champ_id|int in championMap else 'Unknown' %}
                            <div class="champion-item">
                                <img class="champ-icon" src="https://ddragon.leagueoflegends.com/cdn/{{ latestVersion }}/img/champion/{{ champ_name }}.png" alt="{{ champ_name }}">
                                <span class="champ-count">{{ count }}</span>
                            </div>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>

        <!-- Match History Section -->
        <div class="match-history-section">
            <h3>Match History</h3>
            <ul>
                {% for match in team_detail['match_history'] %}
                {% set current_team_name = team_detail['team_name'] %}
                {% set team_100_name = match['teams'][0] %}
                {% set team_200_name = match['teams'][1] %}
                {% set match_info = match['data']['info']['teams'] %}
                {% set is_current_team_100 = (current_team_name == team_100_name) %}
                {% set current_team_won = (is_current_team_100 and match_info[0]['win']) or (not is_current_team_100 and match_info[1]['win']) %}
                <li>
                    <a href="{{ url_for('match_detail', object_id=match['_id']|string) }}" class="match-button {% if current_team_won %}win{% else %}loss{% endif %}">
                        <div class="champ-icons">
                            <div class="team-100-champs">
                                <span class="team-name">{{ team_100_name }}</span>
                                <div class="icons">
                                    {% for participant in match['data']['info']['participants'] %}
                                    {% if participant['teamId'] == 100 %}
                                    <img src="https://ddragon.leagueoflegends.com/cdn/{{ latestVersion }}/img/champion/{{ championMap[participant['championId']] }}.png" alt="{{ championMap[participant['championId']] }}">
                                    {% endif %}
                                    {% endfor %}
                                </div>
                            </div>
                            <div class="team-200-champs">
                                <span class="team-name">{{ team_200_name }}</span>
                                <div class="icons">
                                    {% for participant in match['data']['info']['participants'] %}
                                    {% if participant['teamId'] == 200 %}
                                    <img src="https://ddragon.leagueoflegends.com/cdn/{{ latestVersion }}/img/champion/{{ championMap[participant['championId']] }}.png" alt="{{ championMap[participant['championId']] }}">
                                    {% endif %}
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </a>
                </li>
                {% endfor %}
            </ul>
        </div>

        <!-- Current Roster Section -->
        <div class="roster-section">
            <h3>Current Roster</h3>
            <ul>
                {% for player in team_detail['current_roster'] %}
                <li>
                    <a href="{{ url_for('player_detail', object_id=player['_id']) }}">
                        {{ player['summoner_names'][0] }}
                    </a>
                </li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>

<style>
    .team-detail-container {
        display: flex;
        flex-direction: column;
        gap: 20px;
        padding: 20px;
    }

    .header-section {
        text-align: center;
    }

    .main-layout {
        display: grid;
        grid-template-columns: 2fr 1fr;
        grid-template-rows: auto auto;
        gap: 10px;
    }

    .stats-section {
        grid-column: 1 / 2;
        border: 1px solid var(--bg-medium-blue);
        padding: 10px;
        background-color: var(--bg-dark-blue);
        border-radius: 8px;
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .champion-stats-section {
        grid-column: 2 / 3;
        border: 1px solid var(--bg-medium-blue);
        padding: 10px;
        background-color: var(--bg-dark-blue);
        border-radius: 8px;
        display: flex;
        flex-direction: column;
        gap: 10px;
        max-height: 500px;
    }

    .champion-table {
        display: flex;
        justify-content: space-between;
        gap: 10px;
    }

    .champ-column {
        display: flex;
        flex-direction: column;
        gap: 5px;
        overflow-y: auto;
        max-height: 300px;
        width: 33.333%;
        flex-grow: 1;
    }

    .header-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: space-between;
        height: 80px;
        margin-bottom: 10px;
    }

    .header-box, .total-box {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 40px;
        width: 100%;
        text-align: center;
    }

    .header-box h4, .total-box p {
        margin: 0;
        font-size: clamp(14px, 2vw, 16px);
    }

    .scrollable-list {
        list-style: none;
        padding: 0;
        margin: 0;
        overflow-y: auto;
        flex-grow: 1;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
    }

    .scrollable-list::-webkit-scrollbar {
        width: 4px;
    }

    .scrollable-list::-webkit-scrollbar-thumb {
        background: var(--accent-light-gold);
        border-radius: 10px;
    }

    .scrollable-list::-webkit-scrollbar-track {
        background: var(--bg-dark-blue);
        border-radius: 10px;
    }

    .champion-item {
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .champ-icon {
        width: 32px;
        height: 32px;
        border-radius: 5px;
    }

    .champ-count {
        font-weight: bold;
        color: var(--text-light);
    }

    .match-history-section {
        grid-column: 1 / 2;
        border: 1px solid var(--bg-medium-blue);
        padding: 10px;
        background-color: var(--bg-dark-blue);
        border-radius: 8px;
        display: flex;
        flex-direction: column;
        gap: 10px;
        max-height: 350px; /* Extended height */
        overflow-y: auto; /* Enable scrolling */
    }

    .match-history-section ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .match-history-section li {
        margin-bottom: 5px;
    }

    .match-button {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 2px 10px;
        border-radius: 8px;
        text-decoration: none;
        color: #fff;
        background-color: var(--bg-medium-blue);
        transition: background-color 0.3s ease;
        font-size: 12px;
        height: 36px;
        position: relative;
    }

    .match-button.win {
        background-color: #28a745;
    }

    .match-button.loss {
        background-color: #dc3545;
    }

    .match-button:hover {
        background-color: rgba(255, 255, 255, 0.1); /* Lighten the button color on hover */
    }

    .champ-icons {
        display: flex;
        align-items: center;
        gap: 5px;
        justify-content: space-around;
        width: 100%;
    }

    .champ-icons .team-name {
        font-weight: bold;
        font-size: 11px;
        text-align: center;
        margin-bottom: 2px;
    }

    .icons {
        display: flex;
        gap: 1px;
        justify-content: center;
    }

    .icons img {
        width: 18px;
        height: 18px;
        border-radius: 3px;
    }

    .team-100-champs,
    .team-200-champs {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 1px;
    }
</style>



{% endblock %}
